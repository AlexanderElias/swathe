/*
title: swathe
version: 1.2.0
author: alexander elias
*/
(function(){function n(a,e){return e?e.constructor.name===a:!1}function k(a,e,d){var c,b,g;b=null;if(n("Number",a))for(b=0;b<a&&(c=e.call(d,b,a),"break"!==c);b++);else if(n("Object",a))for(b in a){if(a.hasOwnProperty(b)&&(c=e.call(d,a[b],b,a),"break"===c))break}else for(b=0,g=a.length;b<g&&(c=e.call(d,a[b],b,a),"break"!==c);b++);return a}function q(a,e){for(var d=e.replace("]","").replace("[",".").split("."),c=d.length-1,b=a,g=0;g<c;g++){var f=d[g];if(!b[f])return;b=b[f]}return b[d[c]]}function v(a,
e,d){e=e.replace("]","").replace("[",".").split(".");for(var c=e.length-1,b=a,g=0;g<c;g++){var f=e[g];b[f]||(b[f]={});b=b[f]}b[e[c]]=d;return a}function A(a){for(;a.firstChild;)a.removeChild(a.firstChild);return a}function B(a){return a.replace(/(-.)/g,function(a){return a[1].toUpperCase()})}function w(a){a=a.replace(/^data-s-/,"");a=a.replace(/^s-/,"");return a=B(a)}function x(a,e,d,c,b,g){var f,h,l,p,k;c=c||{};b=b||{};g=g||{};d=d||[];p=d.length;for(var r=0,n=e.children.length;r<n;r++){l=e.children[r];
h=!1;k=l.getAttribute("s-controller")||l.getAttribute("data-s-controller");if(0<l.attributes.length&&!k)for(var t=0,m=l.attributes.length;t<m;t++)f=l.attributes[t],/(^s-)|(^data-s)/.test(f.name)&&(h=f.name,h=w(h),f=f.value,b[h]||(b[h]=[]),b[h].push(p),g[f]||(g[f]=[]),g[f].push(p),c[h+":"+f]||(c[h+":"+f]=[]),c[h+":"+f].push(p),h=!0);h&&(p++,d.push(l));0<l.children.length&&!k&&x(a,l,d,c,b,g)}a.sPaths=c;a.sNames=b;a.sValues=g;a.sElements=d}function C(a,e,d,c){c=c.replace(/\(/g,", ");c=c.replace(/\)/g,
"");c=c.split(", ");d=d.replace(/(^on)|(^event)/g,"");d=d.toLowerCase();var b=c[0],g=c;g.splice(0,1);g.forEach(function(b,c){/^[0-9]*$/.test(b)?g[c]=parseInt(b):/(')|(")|(`)/.test(b)||(g[c]=q(a,b))});c=q(a,b);c=c.bind.apply(c,[e].concat(g));e.addEventListener(d,c)}function D(a,e,d,c){d=c.split(" of ");var b=d[0],g=d[1];d=q(a,g);var f=document.createDocumentFragment();k(d.length,function(){k(e.children,function(a){f.appendChild(a.cloneNode(!0))})});d=new m(f);c=d.findByValue(b);k(c,function(a,c){k(a.attributes,
function(a){a.value===b&&(a.value=g+"."+c)})});u(a,d.sElements);e=A(e);e.appendChild(f)}function u(a,e,d){k(e,function(c){k(c.attributes,function(b){if(b&&/(^s-)|(^data-s)/.test(b.name)){var e=w(b.name);b=b.value;if(/(^on.*)|(^event.*)/.test(e))C(a,c,e,b);else if(/for/.test(e))D(a,c,e,b);else if(!/value/.test(e)){var f=d,f=f||q(a,b);v(c,e,f)}}})})}function E(a,e){var d=function(a){a=a.target;var b=a.value,c=null,d;a.hasAttribute("s-value")?c="s-value":a.hasAttribute("data-s-value")&&(c="data-s-value");
d=a.getAttribute(c);e(c,d,b,a)};k(a,function(a){a.addEventListener("input",d)});return a}function y(a,e,d){d||(d="");return new Proxy(a,{get:function(a,b){return n("Object",a[b])||n("Array",a[b])?y(a[b],e,d+b+"."):a[b]},set:function(a,b,g){a[b]!==g&&(a[b]=g,e(d+b,g));return!0}})}function z(a,e,d){var c={},b={},g=function(a,b,d){return{enumerable:!0,configurable:!0,get:function(){return a[b]},set:function(c){c!==a[b]&&(a[b]=c,e(d,c))}}},f;for(f in a){var h=a[f],k=d?d+"."+f:f,m=d?d+"."+f:f;n("Object",
h)?c[f]=z(h,e,k):b[f]=g(a,f,m)}return Object.defineProperties(c,b)}var m=function(a){this.sElements=[];this.sPaths={};this.sNames={};this.sValues={};this.scope=a;x(this,a)};m.prototype.findByName=function(a){var e=this;return e.sNames[a].map(function(a){return e.sElements[a]})};m.prototype.findByValue=function(a){var e=this;return e.sValues[a].map(function(a){return e.sElements[a]})};m.prototype.findByPath=function(a,e){var d=this;return d.sPaths[a+":"+e].map(function(a){return d.sElements[a]})};
var F=function(a,e,d){var c=window.Proxy?y:z,b=this;b.name=a;b.model=e;b.dom=new m(d);b.valueElements=b.dom.findByName("value");b.model=c(b.model,function(a,c){var d=b.dom.findByValue(a);u(b.model,d,c)});b.view=E(b.valueElements,function(a,c,d){v(b.model,c,d)})};window.Swathe||(window.Swathe={controllers:{},controller:function(a,e,d){if(!a)throw Error("Controller - name parameter required");if(!e)throw Error("Controller - model parameter required");d=document.querySelector("[s-controller="+a+"]")||
document.querySelector("[data-s-controller="+a+"]");if(!d)throw Error('Controller - missing or invalid "s-controller" attribute');this.controllers[a]=new F(a,e,d);u(this.controllers[a].model,this.controllers[a].dom.sElements);return this.controllers[a]}})})();
