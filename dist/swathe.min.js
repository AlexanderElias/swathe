/*
title: swathe
version: 2.0.0
author: alexander elias
*/
(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?module.exports=b():'function'==typeof define&&define.amd?define('Swathe',b):a.Swathe=b()})(this,function(){'use strict';function a(s){var t='';for(var u in s)t=0<t.length?t+'&':t,t=t+encodeURIComponent(u)+'='+encodeURIComponent(s[u]);return t}function c(s){this.view=s.view,this.PREFIX=/(^data-s-)|(^s-)/,this.BINDER_CMD=/(^data-s-)|(^s-)|((-|\.)(.*?)$)/g,this.BINDER_OPT=/((^data-s-)|(^s-))(\w+(\.|-)?)/,this.ADAPTER_CMD=/\((.*?)$/,this.ADAPTER_OPT=/(^(.*?)\()|(\)(.*?)$)/g,this.NUMBER=/^\d{1,}$/,this.STRING=/(^')|(^")|(^`)/,this.BOOLEAN=/(^true$)|(^false$)/,this.ALL=/(s-(.*?)=)/,this.SKIPS=/(<input)/,this.REJECTS=/(<iframe)|(<script)|(<style)|(<link)|(<object)|(s-controller=)/}function d(s){this.model=s.model,this.isProxy=!!Proxy}function f(s,t){var u=this;u.doc=s.doc,u.name=s.name,u.query='[s-controller="'+u.name+'"], [data-s-controller="'+u.name+'"]',u.model=s.model,u.view=u.doc.querySelector(u.query),u.ModelInterface=new d({model:u.model}),u.ViewInterface=new c({view:u.view}),u.ModelInterface.setup(u.ViewInterface),u.ViewInterface.setup(u.ModelInterface),u.model=u.ModelInterface.model,u.view=u.ViewInterface.view,t&&t(u)}var g=`[s-controller], [data-s-controller] {transition: all 300ms ease;-o-transition: all 300ms ease;-ms-transition: all 300ms ease;-moz-transition: all 300ms ease;-webkit-transition: all 300ms ease;}.s-if-true {display: inherit;}.s-if-false {display: none;}.s-show-true {opacity: 1;}.s-show-false {opacity: 0;}`,h=document.createElement('style'),j=document.createTextNode(g);h.appendChild(j);var m={GET:2,SET:3,id:function(){return Math.random().toString(36).substr(2,9)},interact:function(s,t,u,v){for(var A,w=this.getPathKeys(u),x=w.length-1,y=t,z=0;z<x;z++){if(A=w[z],null===y[A]||void 0===y[A]){if(s===this.GET)return;s===this.SET&&(y[A]={})}y=y[A]}return s===this.GET?y[w[x]]:s===this.SET?(y[w[x]]=v,t):void 0},toCleanCase:function(s){return s.replace(/(\[)|(\])/g,function(t){return'['===t?'.':''})},toCamelCase:function(s){return s.replace(/-[a-z]/g,function(t){return t[1].toUpperCase()})},toDashCase:function(s){return s.replace(/[A-Z]/g,function(t){return'-'+t.toLowerCase()})},getPathKeys:function(s){return this.toCamelCase(this.toCleanCase(s)).split('.')},getPathParent:function(s){var t=s.split('.').slice(0,-1).join('.');return''===t?s:t},getByPath:function(s,t){return this.interact(this.GET,s,t)},setByPath:function(s,t,u){return this.interact(this.SET,s,t,u)},removeChildren:function(s){for(;s.firstChild;)s.removeChild(s.firstChild);return s},forEachAttribute:function(s,t,u){var v=s.attributes,w=0,x=[];for(w;w<v.length;w++){var y={value:v[w].value,name:v[w].name,attribute:v[w].name+'="'+v[w].value+'"'};t.test(y.attribute)&&(x.push(y),u&&u(y))}return x},forEachElement:function(s,t,u,v,w){var A,x=s.getElementsByTagName('*'),y=0,z=[];for(y;y<x.length;y++){var B=x[y];if(A=B.outerHTML.replace(B.innerHTML,''),t&&t.test(A))y+=B.children.length;else if(u&&u.test(A))continue;else v&&v.test(A)&&(z.push(B),w&&w(B))}return z}},n={script:'text/javascript, application/javascript, application/x-javascript',json:'application/json, text/javascript',xml:'application/xml, text/xml',html:'text/html',text:'text/plain',urlencoded:'application/x-www-form-urlencoded'},q={mime:n,request:function(s){if(!s)throw new Error('Axa: requires options');if(!s.action)throw new Error('Axa: requires options.action');if(s.method||(s.method='GET'),s.headers||(s.headers={}),s.data)if('GET'===s.method)s.action=s.action+'?'+a(s.data),s.data=null;else{switch(s.requestType=s.requestType.toLowerCase(),s.responseType=s.responseType.toLowerCase(),s.requestType){case'script':s.contentType=n.script;break;case'json':s.contentType=n.json;break;case'xml':s.contentType=n.xm;break;case'html':s.contentType=n.html;break;case'text':s.contentType=n.text;break;default:s.contentType=n.urlencoded;}switch(s.responseType){case'script':s.accept=n.script;break;case'json':s.accept=n.json;break;case'xml':s.accept=n.xml;break;case'html':s.accept=n.html;break;case'text':s.accept=n.text;}s.contentType===n.json&&(s.data=JSON.stringify(s.data)),s.contentType===n.urlencoded&&(s.data=a(s.data))}var t=new XMLHttpRequest;if(t.open(s.method.toUpperCase(),s.action,!0,s.username,s.password),s.mimeType&&t.overrideMimeType(s.mimeType),s.withCredentials&&(t.withCredentials=s.withCredentials),s.accept&&(s.headers.Accept=s.accept),s.contentType&&(s.headers['Content-Type']=s.contentType),s.headers)for(var u in s.headers)t.setRequestHeader(u,s.headers[u]);t.onreadystatechange=function(){if(4===t.readyState)return 200<=t.status&&400>t.status?s.success(t):s.error(t)},t.send(s.data)},serialize:a};c.prototype._on=function(s){var t=this;if('function'==typeof s.value){var u=s.adapter.opt.split(', ').map(function(v){return t.STRING.test(v)?v.replace(/(')|(")|(`)/g,''):t.NUMBER.test(v)?+v:t.BOOLEAN.test(v)?!!v:t.ModelInterface.get(v)});u.splice(0,0,null),s.element.swathe?s.element.removeEventListener(s.binder.opt,s.element.swathe.oldEventListener):s.element.swathe={},s.value=s.value.bind.apply(s.value,u),s.element.addEventListener(s.binder.opt,s.value),s.element.swathe.oldEventListener=s.value}},c.prototype._for=function(s){var u,t=this;s.element.swathe?u=s.element.swathe.originalInnerHTML:(u=s.element.innerHTML,s.element.swathe={},s.element.swathe.originalInnerHTML=u);for(var v=new RegExp('="'+s.binder.opt+'"','g'),w='',x=0,y=s.value.length;x<y;x++)w+=u.replace(v,'="'+s.attribute.value+'['+x.toString()+']"');s.element.innerHTML=w,t.update(t.ALL,s.element)},c.prototype._html=function(s){var t=this;/^</.test(s.value)?(s.element.innerHTML=s.value,t.update(t.ALL,s.element)):q.request({action:s.value,success:function(u){s.element.innerHTML=u.response,t.update(t.ALL,s.element)},error:function(u){throw u}})},c.prototype._if=function(s){'string'==typeof s.value&&(s.value=!!s.value),s.element.hidden=!s.value},c.prototype._class=function(s){'string'==typeof s.value&&(s.value=new Boolean(s.value)),s.element.classList.toggle(s.binder.opt,s.value)},c.prototype._text=function(s){'object'==typeof s.value?s.value=JSON.stringify(s.value):'number'==typeof value&&(s.value=s.value.toString()),s.element.innerText=s.value.toString()},c.prototype._style=function(s){for(var t in s.value)s.value.hasOwnProperty(t)&&(t=m.toDashCase(t),s.element.style.cssText+=t+':'+s.value[t]+';')},c.prototype._value=function(s){s.element.value!==s.value&&(s.element.value=s.value)},c.prototype._this=function(s){s.binder.opt=m.toCamelCase(s.binder.opt),m.setByPath(s.element,s.binder.opt,s.value)},c.prototype._switch=function(s){var t=this;s.binder={cmd:s.attribute.name.replace(t.BINDER_CMD,''),opt:s.attribute.name.replace(t.BINDER_OPT,'')},s.adapter={cmd:s.attribute.value.replace(t.ADAPTER_CMD,''),opt:s.attribute.value.replace(t.ADAPTER_OPT,'')},s.property='_'+s.binder.cmd,s.value=t.ModelInterface.get(s.adapter.cmd),s.value=null===s.value||void 0===s.value?s.attribute.value:s.value,s.property in t?t[s.property](s):console.warn('Unreconized binder: '+s.attribute.name)},c.prototype.update=function(s,t){var u=this;t=t||u.view,s=s||u.ALL,m.forEachElement(t,u.REJECTS,u.SKIPS,u.ALL,function(v){m.forEachAttribute(v,s,function(w){u._switch({element:v,attribute:w})})})},c.prototype.setup=function(s){var u,t=this;t.ModelInterface=s,t.update(),t.view.addEventListener('change',function(v){u=v.target.getAttribute('s-value')||v.target.getAttribute('data-s-value'),u&&t.ModelInterface.set(u,v.target.value)},!1)},d.prototype.proxy=function(s,t,u){var w,v=this;u||(u='');return new Proxy(s,{get:function(y,z){return w=y[z],null!==w&&void 0!==w&&('Object'===w.constructor.name||'Array'===w.constructor.name)?v.proxy(w,t,u+z+'.'):w},set:function(y,z,A){return y[z]!==A&&(y[z]=A,t&&t(u+z,A)),!0}})},d.prototype.define=function(s,t,u){function v(D,E,F){return{enumerable:!0,configurable:!0,get:function(){return D[E]},set:function(G){G!==D[E]&&(D[E]=G,t&&t(F,G))}}}var w=this,x={},y={},z=null,A=null,B=null,C=null;for(z in u||(u=''),s)A=s[z],B=u?u+'.'+z:z,C=u?u+'.'+z:z,null!==A&&void 0!==A&&('Object'===A.constructor.name||'Array'===A.constructor.name)?x[z]=w.define(A,t,B):y[z]=v(s,z,C);return Object.defineProperties(x,y)},d.prototype.get=function(s){return m.getByPath(this.model,s)},d.prototype.set=function(s,t){m.setByPath(this.model,s,t)},d.prototype.setup=function(s){function t(v){v=m.getPathParent(v),v='(((s-)|(data-s-))(.*?)="'+v+'(.*?)")',v=new RegExp(v),u.ViewInterface.update(v)}var u=this;u.ViewInterface=s,u.model=u.isProxy?u.proxy(u.model,t):u.define(u.model,t)};return window.addEventListener('DOMContentLoaded',function(){document.head.appendChild(h)}),{controllers:{},controller:function(s,t){if(!s.name)throw new Error('Controller - name parameter required');if(!s.model)throw new Error('Controller - model parameter required');if(this.controllers[s.name])throw new Error('Controller - name '+s.name+' exists');return s.doc=s.doc||document,this.controllers[s.name]=new f(s,t),this.controllers[s.name]}}});
